\documentclass[a5paper]{article}

\usepackage{hyperref}

\usepackage{luatexja}
\usepackage{luatexja-fontspec}
\usepackage{luatexja-ruby}

\usepackage{calc}
\usepackage{qrcode}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{imakeidx}

\indexsetup{level=\section,toclevel=section}
\makeindex[name=radical,title={部首索引},options={-L}]
\makeindex[name=sikrok,title={四角号碼索引},options={-L}]
\makeindex[name=phonetic,title={諧符索引},options={-L}]
\makeindex[name=zyevio,title={中古音索引},options={-L}]

\usepackage[marginpar=2cm]{geometry}

\setmainfont{Junicode}
\setsansfont{Noto Sans}

\setmainjfont{Noto Serif CJK SC}
\setsansjfont{Noto Sans CJK SC}

\newcommand{\textJapn}[1]{{%
    \newjfontfamily\fontMainJapn{Noto Serif CJK JP}[]%
    \newjfontfamily\fontSansJapn{Noto Sans CJK JP}[]%
    #1%
  }}
\newcommand{\textHant}[1]{{%
    \newjfontfamily\fontMainHans{Noto Serif CJK SC}[]%
    \newjfontfamily\fontSansHans{Noto Sans CJK SC}[]%
    #1%
  }}
\newcommand{\textHans}[1]{{%
    \newjfontfamily\fontMainHans{Noto Serif CJK SC}[]%
    \newjfontfamily\fontSansHans{Noto Sans CJK SC}[]%
    #1%
  }}

% When the current style is m,
% attempting to change to bx,
% use bx if availabke,
% otherwise use b.
\DeclareFontShapeChangeRule{m}{bx}{bx}{b}

\newlength{\EntryDescriptionLineLength}
\newlength{\EntryDescriptionLineHeight}

\providecommand\phantomsection{}

\titleformat{\section}[display]
{%format
  \bfseries\large
}{%label
  %(\thesection)%
}{%sep
  0pt
}{%before-code
  \centering\MakeUppercase
}
\titlespacing*{\section}{0pt}{*4}{0pt}

\newcommand{\PartHeader}[2]{%
  \section{#1}%
  \begin{center}
    \centering #2
  \end{center}
  \vspace{0.5em plus 0.2em minus 0.05em}
}
\newenvironment{Entry}[2]{%
  \noindent
  \setlength{\EntryDescriptionLineHeight}{2\baselineskip}%
  \setlength{\EntryDescriptionLineLength}{\linewidth-2\EntryDescriptionLineHeight}%
  \parshape 3
  \EntryDescriptionLineHeight \EntryDescriptionLineLength
  \EntryDescriptionLineHeight \EntryDescriptionLineLength
  0cm \linewidth%
  %
  \makebox[0pt][r]{%
    \fontseries{bx}\fontsize{2\baselineskip}{2\baselineskip}\selectfont%
    \raisebox{-1ex}[0pt][0pt]{#1}%
    \hspace*{0.1em}%
  }%
  \makebox[0pt][l]{\raisebox{-1ex}[0pt][0pt]{%
      \hspace{\EntryDescriptionLineLength+0.1\EntryDescriptionLineHeight}\qrcode[height=0.9\EntryDescriptionLineHeight]{https://www.chise.org/ids-find?components=#2}}}%
  \phantomsection%
  \addcontentsline{toc}{subsection}{#1}%
  \label{entry-#1}%
}{}

\newenvironment{Sound}{\begin{itemize}}{\end{itemize}}
\newcommand{\SoundItem}[1]{\item[/\textbf{\zyepheng{#1}}/:]}

\newenvironment{Sense}{\begin{itemize}}{\end{itemize}}
\newcommand{\SenseItem}[1]{\item[\{\textbf{\zyepheng{#1}}\}:]}

\newcommand{\zyepheng}[1]{\textsf{#1}}

\newcommand{\SoundPart}[2]{+ {\ltjsetparameter{jacharrange={-9}}#1}#2}
\newcommand{\SoundPartN}[1]{+ {\ltjsetparameter{jacharrange={-9}}#1}}
\newcommand{\SoundPartNI}[1]{+{\ltjsetparameter{jacharrange={-9}}#1}}

\newcommand{\Sikrok}[2]{#1\textsubscript{#2}}
\newcommand{\refEntry}[1]{\hyperref[entry-#1]{#1}}

\newcommand{\Position}[1]{\texttt{\tiny #1}}

\newcommand{\Book}[1]{{《#1》}}

\begin{document}
\part{Examples}
やること
\begin{itemize}
\item{} 諧符見出し
  \begin{itemize}
  \item{} 読みの付加
  \end{itemize}
\item{} 異体字情報
  \begin{itemize}
  \item{} 文言を全体的に修正
  \end{itemize}
\item{} 反切
  \begin{itemize}
  \item{} 重複の除去
  \item{} コメントが文献情報で始まる場合の扱い。例《王韻》欄「《王三》不明,《王一》無本」
  \item{} 項目見出しを行内に入れる
  \item{} 項目間空白の削減
  \end{itemize}
\item{} 義
  \begin{itemize}
  \item{} 文献\kenten{以外}のラテン文字を隋拼扱い
  \item{} 項目見出しを行内に入れる
  \item{} 項目間空白の削減
  \end{itemize}
\item{} フォント
  \begin{itemize}
  \item{} 隋拼
    \begin{itemize}
    \item{} 隋拼
    \item{} aを一階建てに変更
    \item{} 重調符を下から上のものに変更
    \end{itemize}
  \item{} 本文書体
    \begin{itemize}
    \item{} 思源宋体
    \item{} 大きさを12Qに
    \end{itemize}
  \end{itemize}
\item{} データ
  \begin{itemize}
  \item{} Q列「状態」が3のもののみを用いる
  \end{itemize}
\item{} 紙面
  \begin{itemize}
  \item{} 余白の調整
  \item{} 頁番号位置・スタイルの調整
  \end{itemize}
\end{itemize}

\PartHeader{冬符 toŋ}{\refEntry{冬}\refEntry{佟}{疼}{柊}{鼕}{螽}{終}}

\begin{Entry}{冬}{冬}
  + 0（夊部0畫）
  \\
  \Sikrok{2730}{3}
  \begin{Sound}
    \SoundItem{toŋ}《P3798》都宗反，端冬平，上平聲二冬
  \end{Sound}
\end{Entry}

\begin{Entry}{佟}{佟}
  \index[radical]{人部!5畫!佟}%
  \index[sikrok]{2723.3@\Sikrok{2723}{3}!佟}%
  \index[phonetic]{冬+23}%
  \index[zyevio]{doŋ!佟}%
  + 23人（人部5畫）
  \\
  \Sikrok{2723}{3}
  \begin{Sound}
    \SoundItem{doŋ}《P3798》徒冬反，定冬平
  \end{Sound}
\end{Entry}

\PartHeader{中符 tuŋ}{\refEntry{中}仲忠}

\begin{Entry}{中}{\%E5\%86\%AC}%
  \index[radical]{丨部!3畫!中}%
  \index[sikrok]{5000.6@\Sikrok{5000}{6}}%
  \index[phonetic]{中+0}%
  \index[zyevio]{tryuŋ!中}%
  \index[zyevio]{tryûŋ!中}%
  \index[zyevio]{dryûŋ!中}%
  + 0（丨部3畫）
  \\
  \Sikrok{5000}{6}
  \begin{Sound}
    \SoundItem{tryuŋ}《切二》陟隆反, 《廣韵》陟隆切, 知東平, 上平聲一東（中間）
    \SoundItem{tryûŋ}《P3696(1)r》陟仲反, 知送去, 去聲一送（射中, 撃中）
    \SoundItem{dryûŋ}《集韵》直衆切
  \end{Sound}
  \begin{Sense}
    \SenseItem{tryuŋ}義略。
    \SenseItem{tryûŋ}義略。
  \end{Sense}
\end{Entry}

\clearpage{}
\part{Generated}
\input{test-data.tex}
\part{Indices}
やること
\begin{itemize}
\item{} 正しい照合順序を実装
  \begin{itemize}
  \item{} 見出し字
  \item{} 部首
  \item{} 諧符
  \item{} 隋拼
  \end{itemize}
\item{} 見た目の調整
  \begin{itemize}
  \item{} 部見出し
  \item{} 見出し字と頁数
  \end{itemize}
\end{itemize}

\printindex[radical]
\printindex[sikrok]
\printindex[phonetic]
\printindex[zyevio]
\end{document}